# Code Review â€” 20260225-1800

## Fichiers analysÃ©s
| Fichier | Lignes modifiÃ©es | Verdict |
|---------|-----------------|---------|
| .gitignore | binaire | âœ… |
| docs/bmad/prompts/20260225-landing-kore-A.md | +1 / -1 | âœ… |
| docs/bmad/prompts/20260225-landing-kore-B.md | +1 / -1 | âœ… |
| docs/bmad/prompts/20260225-landing-kore-index.md | +2 / -2 | âœ… |
| mobile/src/model/constants.ts | +37 / -0 | âœ… |
| mobile/src/model/models/Program.ts | +2 / -0 | ðŸ”´ |
| mobile/src/navigation/index.tsx | +29 / -2 | ðŸŸ¡ |

## ProblÃ¨mes trouvÃ©s
| # | Fichier | Ligne | ProblÃ¨me | SÃ©vÃ©ritÃ© |
|---|---------|-------|----------|----------|
| 1 | mobile/src/model/models/Program.ts | 26-29 | `duplicate()` ne copie pas les nouveaux champs `equipment` et `frequency` â€” violation Known Pitfall CLAUDE.md Â§3.1 | ðŸ”´ |
| 2 | mobile/src/navigation/index.tsx | 121-128 | `observe()` subscription reste active toute la vie de l'app pour un check one-shot â€” re-renders inutiles | ðŸŸ¡ |

## DÃ©tail des problÃ¨mes

### ðŸ”´ #1 â€” duplicate() incomplet (Program.ts)
Le `duplicate()` Ã  la ligne 26-29 ne copie que `name` et `position`. Les champs `equipment` et `frequency` ajoutÃ©s dans ce diff sont ignorÃ©s. Un programme dupliquÃ© perdrait ses mÃ©tadonnÃ©es d'Ã©quipement et frÃ©quence.

**Fix :** Ajouter dans le callback `create` :
```ts
p.equipment = this.equipment
p.frequency = this.frequency
```

### ðŸŸ¡ #2 â€” observe() pour route initiale (navigation/index.tsx)
`database.get<User>('users').query().observe().subscribe(...)` crÃ©e une subscription RxJS qui reste vivante indÃ©finiment. Or `initialRouteName` n'est lu qu'au premier rendu du Navigator â€” les mises Ã  jour suivantes de `initialRoute` sont sans effet.

**Suggestion :** Remplacer par un `fetch()` one-shot :
```ts
database.get<User>('users').query().fetch().then(users => {
  const user = users[0]
  setInitialRoute(!user || !user.onboardingCompleted ? 'Onboarding' : 'Home')
})
```

## Verdict global : CORRIGE D'ABORD ðŸ”´

## ParallÃ©lisation des corrections
| # | ProblÃ¨me | Fichiers | Effort | Groupe |
|---|----------|----------|--------|--------|
| 1 | duplicate() incomplet | mobile/src/model/models/Program.ts | 1 min | A |
| 2 | observe â†’ fetch | mobile/src/navigation/index.tsx | 2 min | B |

Groupes : fichiers diffÃ©rents â†’ parallÃ©lisable.
- Claude Code 1 : Groupe A (problÃ¨me #1 â€” Program.ts)
- Claude Code 2 : Groupe B (problÃ¨me #2 â€” navigation/index.tsx)

## RÃ©solution
- ProblÃ¨me #1 : âœ… RÃ©solu â€” 20260225-1810 â†’ `docs/bmad/do/20260225-1810-fix-program-duplicate.md`
- ProblÃ¨me #2 : âœ… RÃ©solu â€” 20260225-1815 â†’ `57aa1cf` perf(navigation): replace observe() with one-shot fetch()
