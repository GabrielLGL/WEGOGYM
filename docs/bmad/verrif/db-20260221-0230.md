# Cohérence WatermelonDB — 20260221-0230

## Résultat : ✅ Cohérent — aucune incohérence

---

## Tables : Schéma ↔ Modèles

| Table schéma       | Modèle           | Statut |
|--------------------|------------------|--------|
| `programs`         | `Program.ts`     | ✅     |
| `sessions`         | `Session.ts`     | ✅     |
| `session_exercises`| `SessionExercise.ts` | ✅ |
| `exercises`        | `Exercise.ts`    | ✅     |
| `performance_logs` | `PerformanceLog.ts` | ✅  |
| `users`            | `User.ts`        | ✅     |
| `histories`        | `History.ts`     | ✅     |
| `sets`             | `Set.ts`         | ✅     |

8 tables dans le schéma → 8 modèles → tous enregistrés dans `database.modelClasses` ✅

---

## Colonnes schéma ↔ Décorateurs modèles

### `programs`
| Colonne schéma | Décorateur modèle | OK |
|---------------|-------------------|----|
| name (string) | `@text('name')` | ✅ |
| position (number, opt) | `@field('position')` | ✅ |
| created_at (number) | `@readonly @date('created_at')` | ✅ |
| updated_at (number) | `@readonly @date('updated_at')` | ✅ |

### `sessions`
| Colonne schéma | Décorateur modèle | OK |
|---------------|-------------------|----|
| program_id (string) | `@relation('programs', 'program_id')` | ✅ |
| name (string) | `@field('name')` | ✅ |
| position (number, opt) | `@field('position')` | ✅ |
| created_at (number) | `@readonly @date('created_at')` | ✅ |
| updated_at (number) | `@readonly @date('updated_at')` | ✅ |
| deleted_at (number, opt) | `@date('deleted_at')` | ✅ |

### `session_exercises`
| Colonne schéma | Décorateur modèle | OK |
|---------------|-------------------|----|
| session_id (string) | `@relation('sessions', 'session_id')` | ✅ |
| exercise_id (string) | `@relation('exercises', 'exercise_id')` | ✅ |
| position (number) | `@field('position')` | ✅ |
| sets_target (number, opt) | `@field('sets_target')` | ✅ |
| reps_target (string, opt) | `@field('reps_target')` | ✅ |
| weight_target (number, opt) | `@field('weight_target')` | ✅ |
| created_at (number) | `@readonly @date('created_at')` | ✅ |
| updated_at (number) | `@readonly @date('updated_at')` | ✅ |

### `exercises`
| Colonne schéma | Décorateur modèle | OK |
|---------------|-------------------|----|
| name (string) | `@text('name')` | ✅ |
| is_custom (boolean) | `@field('is_custom')` | ✅ |
| muscles (string, opt) | `@text('muscles')` (JSON stringifié) | ✅ |
| equipment (string, opt) | `@text('equipment')` | ✅ |
| created_at (number) | `@readonly @date('created_at')` | ✅ |
| updated_at (number) | `@readonly @date('updated_at')` | ✅ |

### `performance_logs`
| Colonne schéma | Décorateur modèle | OK |
|---------------|-------------------|----|
| exercise_id (string) | `@relation('exercises', 'exercise_id')` | ✅ |
| sets (number) | `@field('sets')` | ✅ |
| weight (number) | `@field('weight')` | ✅ |
| reps (number) | `@field('reps')` | ✅ |
| created_at (number) | `@readonly @date('created_at')` | ✅ |
| *(pas de updated_at)* | *(absent du modèle aussi)* | ✅ |

### `users`
| Colonne schéma | Décorateur modèle | OK |
|---------------|-------------------|----|
| email (string) | `@text('email')` | ✅ |
| timer_enabled (boolean) | `@field('timer_enabled')` | ✅ |
| rest_duration (number) | `@field('rest_duration')` | ✅ |
| onboarding_completed (boolean) | `@field('onboarding_completed')` | ✅ |
| ai_provider (string, opt) | `@text('ai_provider')` | ✅ |
| ai_api_key (string, opt) | `@text('ai_api_key')` | ✅ |
| created_at (number) | `@readonly @date('created_at')` | ✅ |
| updated_at (number) | `@readonly @date('updated_at')` | ✅ |

### `histories`
| Colonne schéma | Décorateur modèle | OK |
|---------------|-------------------|----|
| session_id (string) | `@relation('sessions', 'session_id')` | ✅ |
| start_time (number) | `@date('start_time')` | ✅ |
| end_time (number, opt) | `@date('end_time')` | ✅ |
| note (string, opt) | `@text('note')` | ✅ |
| created_at (number) | `@readonly @date('created_at')` | ✅ |
| updated_at (number) | `@readonly @date('updated_at')` | ✅ |
| deleted_at (number, opt) | `@date('deleted_at')` | ✅ |

### `sets`
| Colonne schéma | Décorateur modèle | OK |
|---------------|-------------------|----|
| history_id (string) | `@relation('histories', 'history_id')` | ✅ |
| exercise_id (string) | `@relation('exercises', 'exercise_id')` | ✅ |
| weight (number) | `@field('weight')` | ✅ |
| reps (number) | `@field('reps')` | ✅ |
| set_order (number) | `@field('set_order')` | ✅ |
| is_pr (boolean) | `@field('is_pr')` | ✅ |
| created_at (number) | `@readonly @date('created_at')` | ✅ |
| updated_at (number) | `@readonly @date('updated_at')` | ✅ |

---

## Relations

| Modèle | Relation | Table cible | OK |
|--------|----------|-------------|----|
| Program | `has_many sessions` (foreignKey: program_id) | `sessions` ✅ | ✅ |
| Session | `belongs_to programs` (key: program_id) | `programs` ✅ | ✅ |
| Session | `has_many histories` (foreignKey: session_id) | `histories` ✅ | ✅ |
| Session | `has_many session_exercises` (foreignKey: session_id) | `session_exercises` ✅ | ✅ |
| SessionExercise | `belongs_to sessions` (key: session_id) | `sessions` ✅ | ✅ |
| SessionExercise | `belongs_to exercises` (key: exercise_id) | `exercises` ✅ | ✅ |
| Exercise | `has_many session_exercises` (foreignKey: exercise_id) | `session_exercises` ✅ | ✅ |
| Exercise | `has_many performance_logs` (foreignKey: exercise_id) | `performance_logs` ✅ | ✅ |
| Exercise | `has_many sets` (foreignKey: exercise_id) | `sets` ✅ | ✅ |
| PerformanceLog | `belongs_to exercises` (key: exercise_id) | `exercises` ✅ | ✅ |
| History | `belongs_to sessions` (key: session_id) | `sessions` ✅ | ✅ |
| History | `has_many sets` (foreignKey: history_id) | `sets` ✅ | ✅ |
| Set | `belongs_to histories` (key: history_id) | `histories` ✅ | ✅ |
| Set | `belongs_to exercises` (key: exercise_id) | `exercises` ✅ | ✅ |

Aucune relation orpheline. ✅

---

## Migrations

Aucun fichier de migrations trouvé. La DB est initialisée avec `SQLiteAdapter` sans `migrations` → recréation complète à chaque bump de version. **Info (pas erreur)** — stratégie intentionnelle du projet.

---

## Notes mineures (non-bloquantes)

- `Session.ts` utilise `@field('name')` pour une colonne `string` — `@text` serait plus idiomatique (comme dans `Program.ts`). Pas de bug fonctionnel, simple inconsistance de style.
- `performance_logs` n'a pas de `updated_at` dans le schéma (intentionnel — les logs sont immuables). Le modèle est cohérent avec ce choix.
