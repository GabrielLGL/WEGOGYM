<!-- v1.0 — 2026-02-28 -->
# Rapport — GIF exercice — Groupe B — Navigation ExercisesScreen — 20260228-1930

## Objectif
Modifier `ExercisesScreen` pour qu'un appui sur un exercice ouvre `ExerciseInfoSheet`
(avec le GIF) à la place de naviguer directement vers `ExerciseHistory`.
L'accès à l'historique reste disponible via un bouton dans la fiche.

## Fichiers concernés
- `mobile/src/screens/ExercisesScreen.tsx` — modification du handler de press + ajout ExerciseInfoSheet
- `mobile/src/components/ExerciseInfoSheet.tsx` — ajout d'une prop `onViewHistory` + bouton

## Contexte technique

### Comportement actuel d'ExercisesScreen
```tsx
const handleRowPress = useCallback((item: Exercise) => {
  haptics.onSelect()
  navigation.navigate('ExerciseHistory', { exerciseId: item.id })
}, [haptics, navigation])
```
→ Ce handler navigue directement vers l'historique. Il faut le remplacer par l'ouverture du sheet.

### ExerciseInfoSheet — état après Groupe A
Le composant `ExerciseInfoSheet` (défini après le Groupe A) a cette interface :
```tsx
interface ExerciseInfoSheetProps {
  exercise: Exercise
  visible: boolean
  onClose: () => void
}
```
Il faut ajouter une prop optionnelle `onViewHistory` pour le bouton d'accès à l'historique.

### Patterns du projet à respecter
- **État modal** : utiliser `useModalState()` depuis `hooks/useModalState.ts`
  → `const infoSheet = useModalState()` → `{ isOpen, open, close }`
- **Haptics** : `useHaptics()` déjà utilisé dans ExercisesScreen
- **Portal** : ExerciseInfoSheet utilise déjà BottomSheet + Portal → aucune config supplémentaire
- **`withObservables`** : ne pas modifier la logique de data-fetching

### Structure de useModalState
```tsx
const modal = useModalState()
// modal.isOpen: boolean
// modal.open(): void
// modal.close(): void
// modal.toggle(): void
```

## Étapes

### 1. Modifier `ExerciseInfoSheet.tsx` — ajout prop `onViewHistory`
Ajouter la prop optionnelle et un bouton en bas du sheet :
```tsx
interface ExerciseInfoSheetProps {
  exercise: Exercise
  visible: boolean
  onClose: () => void
  onViewHistory?: () => void  // NOUVEAU — optionnel
}
```

Ajouter un bouton "Voir l'historique" sous la section Notes si `onViewHistory` est défini :
```tsx
{onViewHistory && (
  <TouchableOpacity style={styles.historyButton} onPress={onViewHistory}>
    <Text style={styles.historyButtonText}>{t.exerciseInfoSheet.viewHistory}</Text>
    <Ionicons name="arrow-forward" size={16} color={colors.primary} />
  </TouchableOpacity>
)}
```

Styles à ajouter :
```tsx
historyButton: {
  flexDirection: 'row',
  alignItems: 'center',
  justifyContent: 'center',
  gap: spacing.xs,
  paddingVertical: spacing.sm,
  marginTop: spacing.xs,
},
historyButtonText: {
  color: colors.primary,
  fontSize: fontSize.sm,
  fontWeight: '600',
},
```

Ajouter les traductions dans fr.ts et en.ts :
```typescript
// fr.ts
viewHistory: 'Voir l\'historique',

// en.ts
viewHistory: 'View history',
```

### 2. Modifier `ExercisesScreen.tsx`

**a) Ajouter imports :**
```tsx
import { ExerciseInfoSheet } from '../components/ExerciseInfoSheet'
import { useModalState } from '../hooks/useModalState'
```

**b) Dans le composant, ajouter le state :**
```tsx
const infoSheet = useModalState()
const [selectedExercise, setSelectedExercise] = useState<Exercise | null>(null)
```

**c) Remplacer `handleRowPress` :**
```tsx
const handleRowPress = useCallback((item: Exercise) => {
  haptics.onSelect()
  setSelectedExercise(item)
  infoSheet.open()
}, [haptics, infoSheet])
```

**d) Ajouter le handler historique :**
```tsx
const handleViewHistory = useCallback(() => {
  if (!selectedExercise) return
  infoSheet.close()
  navigation.navigate('ExerciseHistory', { exerciseId: selectedExercise.id })
}, [selectedExercise, infoSheet, navigation])
```

**e) Ajouter le rendu du sheet dans le JSX (juste avant la fermeture du return) :**
```tsx
{selectedExercise && (
  <ExerciseInfoSheet
    exercise={selectedExercise}
    visible={infoSheet.isOpen}
    onClose={infoSheet.close}
    onViewHistory={handleViewHistory}
  />
)}
```

## Contraintes
- Ne pas casser : les exercices custom (handleLongPress/edit/delete doivent rester inchangés)
- **`selectedExercise` ne doit pas se reset à null à la fermeture** — le GIF reste visible pendant l'animation de fermeture du sheet. Utiliser `onClose` sans reset immédiat.
  Pattern correct :
  ```tsx
  const handleCloseSheet = useCallback(() => {
    infoSheet.close()
    // Ne pas setSelectedExercise(null) ici — laisser l'animation terminer
  }, [infoSheet])
  ```
- Pas de `any` TypeScript
- Pas de couleurs hardcodées
- `useState` import déjà présent dans ExercisesScreen (vérifier avant d'ajouter)

## Critères de validation
- `cd mobile && npx tsc --noEmit` → zéro erreur
- `npm test` → zéro fail
- Appuyer sur un exercice → ExerciseInfoSheet s'ouvre avec le GIF (ou icône barbell)
- Bouton "Voir l'historique" dans le sheet → navigue vers ExerciseHistory
- Fermeture du sheet → retour à la liste, aucun crash
- Exercices custom : long press → menu edit/delete toujours fonctionnel

## Dépendances
**Dépend du Groupe A** — ExerciseInfoSheet doit être modifié (Groupe A) avant ce groupe.

## Statut
✅ Résolu — 20260301-0900

## Résolution
Rapport do : docs/bmad/do/20260301-0900-feat-exercise-gif-navigation.md
