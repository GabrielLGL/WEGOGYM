# Prompt analysé — CI Optimize — 20260219-1330

## Demande originale
"Some checks haven't completed yet - CI Tests / Run Tests (20.x) met plus de 6 min à passer, est-ce normal ?"

## Analyse

### Diagnostic : OUI, 6 min est normal pour ce setup

| Step ci.yml | Cause de lenteur | Temps estimé |
|-------------|-----------------|--------------|
| `npm ci --legacy-peer-deps` | ~900 packages React Native, runner partagé. Cache npm = tarballs seulement, node_modules réinstallé à chaque run | 3-4 min |
| `npm test -- --coverage` | Coverage instrumente tout le code (Istanbul), 2-4× plus lent que sans | 1-2 min |
| `codecov/codecov-action@v4` | Upload du rapport coverage | ~30s |

### Bottlenecks identifiés dans `.github/workflows/ci.yml`
1. Pas de cache node_modules (seulement cache npm cache = tarball cache)
2. Coverage activée systématiquement (`--coverage`) alors que `fail_ci_if_error:false` suggère que Codecov est optionnel
3. Pas de `--forceExit` ni `--passWithNoTests` → risque de hang
4. Pas de `timeout-minutes` sur le job

### Optimisations proposées
1. Cache `node_modules` directement avec `actions/cache@v4` + skip `npm ci` si hit
2. Séparer tests (rapides, critiques) et coverage (lente, optionnelle)
3. Ajouter `--forceExit --passWithNoTests` au test command
4. Ajouter `timeout-minutes: 10` sur le job

## Commandes générées

| Groupe | /do | Fichiers | Parallèle |
|--------|-----|----------|-----------|
| A | Optimiser ci.yml : cache node_modules + séparer coverage | `.github/workflows/ci.yml` | Seul |

## Gain estimé après optimisation
- Cache hit (2ème run+) : npm ci skip → **−3 min**
- Coverage optionnelle : tests seuls → **−1 min sur le path critique**
- Résultat cible : **< 2 min** sur cache hit, **< 5 min** sur cache miss
