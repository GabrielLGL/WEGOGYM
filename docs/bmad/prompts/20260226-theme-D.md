<!-- v1.0 — 2026-02-26 -->
# Rapport — Migration composants + écrans — Groupe D — 20260226

## Objectif
Migrer TOUS les composants et écrans de `colors` statique vers `useColors()` dynamique.
Sans cette migration, le toggle dark/light ne change pas l'apparence des composants.

## Problème technique
`StyleSheet.create({ backgroundColor: colors.background })` est évalué UNE FOIS
au chargement du module. Les valeurs statiques ne répondent pas au ThemeContext.
→ Il faut déplacer `StyleSheet.create` à l'intérieur d'une fonction `useStyles()`.

## Pattern à appliquer (identique pour chaque fichier)

### AVANT
```tsx
import { colors, spacing, borderRadius, fontSize } from '../theme'

const styles = StyleSheet.create({
  container: { backgroundColor: colors.background },
  text: { color: colors.text },
})

const MyComponent: React.FC = () => {
  return <View style={styles.container}><Text style={styles.text}>Hello</Text></View>
}
```

### APRÈS
```tsx
import { spacing, borderRadius, fontSize } from '../theme'
import { useColors } from '../contexts/ThemeContext'

const MyComponent: React.FC = () => {
  const colors = useColors()
  const styles = useStyles(colors)
  return <View style={styles.container}><Text style={styles.text}>Hello</Text></View>
}

function useStyles(colors: ReturnType<typeof useColors>) {
  return StyleSheet.create({
    container: { backgroundColor: colors.background },
    text: { color: colors.text },
  })
}
```

**Note performance** : `StyleSheet.create` en RN est O(1) et ne crée pas de allocations
supplémentaires en production — safe à appeler dans le render.

---

## Fichiers à migrer (par ordre de priorité visuelle)

### Priorité 1 — Écrans principaux (impact visuel immédiat)
1. `mobile/src/screens/HomeScreen.tsx`
2. `mobile/src/screens/ProgramsScreen.tsx`
3. `mobile/src/screens/ExercisesScreen.tsx`
4. `mobile/src/screens/WorkoutScreen.tsx`
5. `mobile/src/screens/StatsScreen.tsx`

### Priorité 2 — Composants core
6. `mobile/src/components/Button.tsx` (importe déjà neuShadow → ajouter useColors)
7. `mobile/src/components/ChipSelector.tsx` (idem)
8. `mobile/src/components/BottomSheet.tsx`
9. `mobile/src/components/AlertDialog.tsx`
10. `mobile/src/components/SessionItem.tsx`
11. `mobile/src/components/WorkoutExerciseCard.tsx`
12. `mobile/src/components/SetItem.tsx`
13. `mobile/src/components/WorkoutHeader.tsx`
14. `mobile/src/components/ProgramSection.tsx`

### Priorité 3 — Écrans secondaires
15. `mobile/src/screens/SessionDetailScreen.tsx`
16. `mobile/src/screens/AssistantScreen.tsx`
17. `mobile/src/screens/StatsDurationScreen.tsx`
18. `mobile/src/screens/StatsVolumeScreen.tsx`
19. `mobile/src/screens/StatsCalendarScreen.tsx`
20. `mobile/src/screens/StatsRepartitionScreen.tsx`
21. `mobile/src/screens/StatsExercisesScreen.tsx`
22. `mobile/src/screens/StatsMeasurementsScreen.tsx`
23. `mobile/src/screens/BadgesScreen.tsx`
24. `mobile/src/screens/ChartsScreen.tsx`
25. `mobile/src/screens/OnboardingScreen.tsx`

### Priorité 4 — Autres composants
26. `mobile/src/components/HeatmapCalendar.tsx`
27. `mobile/src/components/ExercisePickerModal.tsx`
28. `mobile/src/components/LevelBadge.tsx`
29. `mobile/src/components/XPProgressBar.tsx`
30. `mobile/src/components/StreakIndicator.tsx`
31. `mobile/src/components/BadgeCard.tsx`
32. `mobile/src/components/OnboardingCard.tsx`
33. `mobile/src/components/RestTimer.tsx`
34. `mobile/src/components/AssistantPreviewSheet.tsx`
35. `mobile/src/components/WorkoutSummarySheet.tsx`
36. `mobile/src/components/ExerciseInfoSheet.tsx`
37. `mobile/src/components/ExerciseTargetInputs.tsx`
38. `mobile/src/components/SessionExerciseItem.tsx`
39. `mobile/src/components/ProgramDetailBottomSheet.tsx`
40. `mobile/src/components/LastPerformanceBadge.tsx`

---

## Cas particuliers

### Composants withObservables
Le pattern `withObservables` wrapping ne change pas. Le composant interne utilise `useColors()` normalement :
```tsx
const MyComponentContent: React.FC<Props> = (props) => {
  const colors = useColors()
  const styles = useStyles(colors)
  // ...
}
export default withObservables([...])(MyComponentContent)
```

### neuShadow dynamique
Les composants qui utilisent `neuShadow` statique doivent aussi basculer :
```tsx
// AVANT :
import { neuShadow } from '../theme'

// APRÈS :
import { useTheme } from '../contexts/ThemeContext'
const { neuShadow } = useTheme()
```

### Composants qui n'utilisent PAS colors
Si un composant n'utilise pas `colors` (rare), skip.

---

## Contraintes
- Ne pas changer la logique business — uniquement le wiring de styles
- RESPECTER les Known Pitfalls CLAUDE.md (pas de `any`, pas de hardcoded colors, etc.)
- Après migration : `npx tsc --noEmit` doit rester à 0 erreurs

## Critères de validation
- `npx tsc --noEmit` → zéro erreur
- `npm test` → zéro fail
- Toggle dark/light affecte visuellement les composants migrés

## Dépendances
Groupe B doit être complété. Groupe C peut tourner en parallèle.

## Statut
⏳ En attente
