<!-- v1.0 â€” 2026-02-26 -->
# Rapport â€” Tests web â€” Groupe B : Tests ThemeToggle â€” 20260226-1745

## Objectif
Ã‰crire les tests automatisÃ©s pour le composant `ThemeToggle.tsx`.
Ce composant gÃ¨re le thÃ¨me clair/sombre via `localStorage` et `data-theme` sur `document.documentElement`.

## Fichiers concernÃ©s
- `web/src/components/ThemeToggle.tsx` â€” source (NE PAS MODIFIER)
- `web/src/components/__tests__/ThemeToggle.test.tsx` â€” crÃ©er (nouveau)

## Contexte technique
- Vitest + @testing-library/react + jsdom (configurÃ© par Groupe A)
- Composant `"use client"` avec useState + useEffect
- Interaction avec `document.documentElement.getAttribute("data-theme")`
- Interaction avec `localStorage.setItem("kore-theme", ...)`
- Bouton avec aria-label "Changer le theme clair/sombre"

**Comportement du composant :**
```
Ã‰tat initial : theme = "light" (sauf si data-theme="dark" sur documentElement)
Clic â†’ toggle : lightâ†’dark ou darkâ†’light
Effets du toggle :
  - setState(next)
  - document.documentElement.setAttribute("data-theme", next)
  - localStorage.setItem("kore-theme", next)
Rendu : bouton avec emoji â˜€ï¸ (light) ou ðŸŒ™ (dark)
```

## Ã‰tapes

### 1. CrÃ©er `web/src/components/__tests__/ThemeToggle.test.tsx`

```tsx
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { render, screen, fireEvent } from '@testing-library/react'
import ThemeToggle from '../ThemeToggle'

describe('ThemeToggle', () => {
  beforeEach(() => {
    // Reset DOM et localStorage avant chaque test
    document.documentElement.removeAttribute('data-theme')
    localStorage.clear()
  })

  it('renders le bouton avec aria-label correct', () => {
    render(<ThemeToggle />)
    expect(screen.getByRole('button', { name: /changer le theme/i })).toBeInTheDocument()
  })

  it('affiche â˜€ï¸ par dÃ©faut (thÃ¨me light)', () => {
    render(<ThemeToggle />)
    // Le bouton doit contenir l'emoji soleil
    const btn = screen.getByRole('button')
    expect(btn.textContent).toContain('â˜€ï¸')
  })

  it('passe en dark mode au clic', () => {
    render(<ThemeToggle />)
    const btn = screen.getByRole('button')
    fireEvent.click(btn)
    // data-theme sur documentElement doit Ãªtre "dark"
    expect(document.documentElement.getAttribute('data-theme')).toBe('dark')
    // localStorage doit Ãªtre mis Ã  jour
    expect(localStorage.getItem('kore-theme')).toBe('dark')
  })

  it('retourne en light mode au deuxiÃ¨me clic', () => {
    render(<ThemeToggle />)
    const btn = screen.getByRole('button')
    fireEvent.click(btn) // â†’ dark
    fireEvent.click(btn) // â†’ light
    expect(document.documentElement.getAttribute('data-theme')).toBe('light')
    expect(localStorage.getItem('kore-theme')).toBe('light')
  })

  it('lit data-theme="dark" existant au montage', async () => {
    document.documentElement.setAttribute('data-theme', 'dark')
    render(<ThemeToggle />)
    // useEffect lit l'attribut et met Ã  jour le state
    // On doit voir ðŸŒ™
    await vi.waitFor(() => {
      expect(screen.getByRole('button').textContent).toContain('ðŸŒ™')
    })
  })
})
```

## Contraintes
- Ne pas modifier `ThemeToggle.tsx`
- Les tests doivent Ãªtre indÃ©pendants (reset dans `beforeEach`)
- Pas de mock de localStorage (jsdom le simule nativement)

## CritÃ¨res de validation
- `npm test` (depuis `web/`) â†’ tous les tests ThemeToggle passent (5 tests)
- ZÃ©ro test qui modifie l'Ã©tat global pour les suivants

## DÃ©pendances
Ce groupe dÃ©pend de : **Groupe A** (Vitest doit Ãªtre configurÃ©)

## RÃ©solution
Rapport do : docs/bmad/do/20260226-1159-test-themtoggle.md

## Statut
âœ… RÃ©solu â€” 20260226-1159
