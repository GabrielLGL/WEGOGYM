<!-- v1.0 — 2026-02-28 -->
# Rapport — coverage screens manquants — Groupe C — 20260228-1500

## Objectif
Ajouter des tests pour les 4 screens qui n'avaient aucune couverture.

## Fichiers concernés
- `mobile/src/screens/BadgesScreen.tsx`
- `mobile/src/screens/ExerciseHistoryScreen.tsx`
- `mobile/src/screens/ProgramDetailScreen.tsx`
- `mobile/src/screens/AssistantPreviewScreen.tsx`

## Tests créés
- `mobile/src/screens/__tests__/BadgesScreen.test.tsx`
- `mobile/src/screens/__tests__/ExerciseHistoryScreen.test.tsx`
- `mobile/src/screens/__tests__/ProgramDetailScreen.test.tsx`
- `mobile/src/screens/__tests__/AssistantPreviewScreen.test.tsx`

## Patterns clés appliqués

### withObservables mock — identité
```tsx
jest.mock('@nozbe/with-observables', () =>
  (_keys: unknown, _fn: unknown) =>
  (Component: React.ComponentType<unknown>) => Component
)
```

### withObservables mock — injection de données (ExerciseHistoryScreen)
```tsx
jest.mock('@nozbe/with-observables', () =>
  (_keys: unknown, _fn: unknown) => (Component: React.ComponentType<unknown>) => {
    return function MockEnhanced(_props: unknown) {
      const mockReact = require('react')
      return mockReact.createElement(Component, { exercise: mockExercise, ... })
    }
  }
)
```

### BottomSheet mock synchrone
```tsx
jest.mock('../../components/BottomSheet', () => ({
  BottomSheet: ({ visible, children, title }) => {
    if (!visible) return null
    const mockReact = require('react')
    const { View, Text } = require('react-native')
    return mockReact.createElement(View, null, title ? mockReact.createElement(Text, null, title) : null, children)
  },
}))
```

### LanguageContext mock (non global — requis par fichier)
```tsx
jest.mock('../../contexts/LanguageContext', () => {
  const { translations } = require('../../i18n')
  return {
    useLanguage: () => ({ language: 'fr', t: translations['fr'], setLanguage: jest.fn() }),
    LanguageProvider: ({ children }: { children: React.ReactNode }) => children,
  }
})
```

### React dans jest.mock() factories
`jest.mock()` est hoisted avant les imports → `React` n'est pas défini.
Utiliser `require('react')` et `require('react-native')` à l'intérieur.

## Statut
✅ Complété — 94 suites, 1564 tests, 0 fail
