<!-- v1.0 — 2026-02-28 -->
# Rapport — GIF exercice — Groupe A — Infrastructure + Affichage — 20260228-1930

## Objectif
Installer `expo-image`, créer le mapping statique `animationKey → URL GIF`, et modifier
`ExerciseInfoSheet` pour afficher le GIF animé à la place du placeholder actuel.

## Fichiers concernés
- `mobile/package.json` — ajout de `expo-image` (via `npx expo install expo-image`)
- `mobile/src/model/utils/animationMap.ts` — NOUVEAU fichier (mapping animationKey → URL)
- `mobile/src/components/ExerciseInfoSheet.tsx` — remplacement du placeholder par `<Image>`
- `mobile/src/i18n/fr.ts` — mise à jour de la clé `exerciseInfoSheet`
- `mobile/src/i18n/en.ts` — mise à jour de la clé `exerciseInfoSheet`

## Contexte technique

### Stack
- React Native + Expo 52, **New Architecture / Fabric** → `react-native-fast-image` INCOMPATIBLE
- `expo-image` est l'unique option compatible Fabric, supporte les GIFs et WebP animés
- Thème dynamique : `useColors()` depuis `contexts/ThemeContext.tsx`
- i18n : `useLanguage()` depuis `contexts/LanguageContext.tsx` → `{ t }`
- **No Modal natif** → le BottomSheet est déjà en place dans ExerciseInfoSheet

### ExerciseInfoSheet — état actuel (149 lignes)
Le composant a UN placeholder à remplacer (lignes ~40-46) :
```tsx
<View style={styles.placeholderContainer}>
  <Ionicons name="barbell-outline" size={48} color={colors.textSecondary} />
  <Text style={styles.placeholderText}>{t.exerciseInfoSheet.placeholderText}</Text>
</View>
```
Ce bloc doit devenir la zone d'affichage du GIF.

### Animation keys existants (30 exercices dans exerciseDescriptions.ts)
```
bench_press_barbell, bench_press_dumbbell, incline_bench_press, push_ups, cable_flyes,
dips_chest, pull_ups, barbell_row, lat_pulldown, deadlift, seated_cable_row, back_squat,
leg_press, leg_extension, dumbbell_lunges, bulgarian_split_squat, romanian_deadlift,
lying_leg_curl, barbell_hip_thrust, overhead_press, lateral_raises, face_pull,
dumbbell_curl, ez_bar_curl, triceps_pushdown, skull_crushers, hammer_curl,
crunch, plank, leg_raises
```

### Source GIF — wger.de (free, sans clé API)
wger.de est un projet open-source de fitness avec des GIFs d'exercices.
Pour récupérer les URLs :
1. Recherche d'exercice : `https://wger.de/api/v2/exercise/?format=json&language=2&name=bench+press`
2. Images d'un exercice : `https://wger.de/api/v2/exerciseimage/?exercise_base={id}&format=json`
   → chaque image a un champ `image` avec l'URL complète (ex: `https://wger.de/static/images/exercises/...`)
   → préférer les images avec `is_main: true` si disponible

Utiliser WebFetch / WebSearch pour récupérer les URLs des 30 exercices et construire le map statique.
Si une URL est introuvable pour un exercice, laisser la valeur comme `undefined` (le fallback s'affiche).

## Étapes

### 1. Installer expo-image
```bash
cd mobile && npx expo install expo-image
```

### 2. Créer `mobile/src/model/utils/animationMap.ts`
```typescript
/**
 * animationMap — mapping animationKey → URL GIF (wger.de CDN)
 * Fallback : undefined → l'ExerciseInfoSheet affiche l'icône barbell
 * Source : wger.de API (free, pas de clé requise)
 */
export const ANIMATION_MAP: Record<string, string | undefined> = {
  bench_press_barbell: 'https://wger.de/static/images/exercises/...',
  // ... (à remplir avec les vraies URLs récupérées depuis wger.de)
}
```
- Récupérer les URLs réelles depuis wger.de API pour les 30 animation keys listés ci-dessus
- Si wger.de n'a pas de GIF pour un exercice : `undefined` (pas de placeholder string vide)
- Les URLs doivent pointer vers des `.gif` ou images animées si possible
- Commenter la source dans le fichier

### 3. Modifier `ExerciseInfoSheet.tsx`
Remplacer le bloc placeholder par :
```tsx
import { Image } from 'expo-image'
import { ANIMATION_MAP } from '../model/utils/animationMap'
import { ActivityIndicator } from 'react-native'

// Dans le composant :
const animationUrl = exercise.animationKey ? ANIMATION_MAP[exercise.animationKey] : undefined

// Rendu — remplace le <View style={styles.placeholderContainer}> actuel :
<View style={styles.animationContainer}>
  {animationUrl ? (
    <Image
      source={{ uri: animationUrl }}
      style={styles.animationImage}
      contentFit="contain"
      cachePolicy="memory-disk"
      placeholder={{ thumbhash: undefined }}
      transition={300}
      onLoadStart={() => /* setLoading(true) si nécessaire */}
    />
  ) : (
    // Fallback : icône barbell (comportement actuel préservé)
    <>
      <Ionicons name="barbell-outline" size={48} color={colors.textSecondary} />
      <Text style={styles.placeholderText}>{t.exerciseInfoSheet.noAnimation}</Text>
    </>
  )}
</View>
```

Styles à ajouter/modifier dans `useStyles()` :
```tsx
animationContainer: {
  backgroundColor: colors.cardSecondary,
  borderRadius: borderRadius.md,
  height: 200,
  alignItems: 'center',
  justifyContent: 'center',
  marginBottom: spacing.md,
  overflow: 'hidden',
},
animationImage: {
  width: '100%',
  height: '100%',
},
```
Supprimer `placeholderContainer` (remplacé par `animationContainer`).

### 4. Mettre à jour les traductions

**fr.ts** — remplacer la clé `exerciseInfoSheet` :
```typescript
exerciseInfoSheet: {
  noAnimation: 'Pas de démonstration disponible',
  description: 'Description',
  noDescription: 'Pas de description disponible',
  personalNotes: 'Notes personnelles',
  noNotes: 'Aucune note',
},
```
(Supprimer `placeholderText`, ajouter `noAnimation`)

**en.ts** — même chose :
```typescript
exerciseInfoSheet: {
  noAnimation: 'No demonstration available',
  description: 'Description',
  noDescription: 'No description available',
  personalNotes: 'Personal notes',
  noNotes: 'No notes',
},
```

## Contraintes
- Ne pas casser : `ExercisesScreen`, `ExercisePickerModal` ni aucun autre consommateur de `ExerciseInfoSheet`
- **Pas de `any`** en TypeScript — `ANIMATION_MAP` typage `Record<string, string | undefined>`
- **Pas de couleurs hardcodées** — utiliser `colors.*` du thème
- **Pas de `console.log`** sans `__DEV__`
- `expo-image` uniquement (pas `react-native-fast-image` incompatible Fabric)
- La clé `placeholderText` dans fr.ts et en.ts doit être supprimée ou remplacée — vérifier qu'elle n'est pas utilisée ailleurs avec Grep avant de la supprimer

## Critères de validation
- `cd mobile && npx tsc --noEmit` → zéro erreur
- `npm test` → zéro fail
- Visuellement : ExerciseInfoSheet affiche le GIF si `animationKey` mappé, sinon l'icône barbell
- Pas de régression sur ExercisePickerModal ou autres utilisateurs du composant

## Dépendances
Aucune — ce groupe peut démarrer immédiatement.

## Statut
✅ Résolu — 20260301-0830

## Résolution
Rapport do : docs/bmad/do/20260301-0830-feat-exercise-gif-infra.md
