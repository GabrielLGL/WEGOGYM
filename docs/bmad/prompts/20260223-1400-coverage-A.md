<!-- v1.0 — 2026-02-23 -->
# Rapport — Coverage Tests — Groupe A (Stats Screens) — 20260223-1400

## Objectif
Écrire les tests unitaires pour les 7 écrans Stats manquants. Objectif : couvrir les composants Base (sans withObservables) avec des props mockées.

## Fichiers concernés
**À tester (créer les fichiers test) :**
- `mobile/src/screens/StatsScreen.tsx` → `mobile/src/screens/__tests__/StatsScreen.test.tsx`
- `mobile/src/screens/StatsVolumeScreen.tsx` → `mobile/src/screens/__tests__/StatsVolumeScreen.test.tsx`
- `mobile/src/screens/StatsDurationScreen.tsx` → `mobile/src/screens/__tests__/StatsDurationScreen.test.tsx`
- `mobile/src/screens/StatsExercisesScreen.tsx` → `mobile/src/screens/__tests__/StatsExercisesScreen.test.tsx`
- `mobile/src/screens/StatsCalendarScreen.tsx` → `mobile/src/screens/__tests__/StatsCalendarScreen.test.tsx`
- `mobile/src/screens/StatsMeasurementsScreen.tsx` → `mobile/src/screens/__tests__/StatsMeasurementsScreen.test.tsx`
- `mobile/src/screens/StatsRepartitionScreen.tsx` → `mobile/src/screens/__tests__/StatsRepartitionScreen.test.tsx`

**Ne PAS modifier :**
- Les fichiers source des screens
- Les tests existants

## Contexte technique

### Pattern de test des screens
Chaque screen suit le pattern `withObservables`. Le composant exporté est wrappé, mais le composant **Base** (avant le HOC) est exporté séparément ou accessible. Si le composant Base n'est pas exporté, l'exporter en ajoutant `export` devant la fonction (ex: `export function StatsVolumeScreenBase`).

### Pattern de mock standard (voir SettingsScreen.test.tsx comme référence)
```tsx
import React from 'react'
import { render } from '@testing-library/react-native'
import { StatsVolumeScreenBase } from '../StatsVolumeScreen'

// Mock les dépendances
jest.mock('expo-haptics', () => ({
  impactAsync: jest.fn(),
  notificationAsync: jest.fn(),
  ImpactFeedbackStyle: { Light: 'Light', Medium: 'Medium', Heavy: 'Heavy' },
  NotificationFeedbackType: { Success: 'Success', Error: 'Error' },
}))

jest.mock('../../model/index', () => ({
  database: { write: jest.fn(), get: jest.fn() },
}))

// Mock react-native-chart-kit (utilisé par Volume, Duration, etc.)
jest.mock('react-native-chart-kit', () => ({
  BarChart: 'BarChart',
  LineChart: 'LineChart',
  PieChart: 'PieChart',
  ContributionGraph: 'ContributionGraph',
}))

// Mock @react-navigation/native
jest.mock('@react-navigation/native', () => ({
  useNavigation: () => ({ navigate: jest.fn() }),
}))
```

### Structure des screens Stats
Tous les Stats screens prennent des props injectées par withObservables :
- `sets: WorkoutSet[]` — données mockées avec `{ id, reps, weight, historyId }`
- `exercises: Exercise[]` — données mockées avec `{ id, name, primaryMuscle }`
- `histories: History[]` — données mockées avec `{ id, date, deletedAt, durationMinutes }`
- `user: User` — objet mocké avec les champs standards
- Certains utilisent `bodyMeasurements: BodyMeasurement[]`

### Cas de test par screen
Pour chaque screen, tester au minimum :
1. **Rendu sans données** — render avec tableaux vides → pas de crash
2. **Rendu avec données** — render avec données mockées → affiche les éléments attendus
3. **Interaction** — sélecteur de période (ChipSelector) si présent → change l'affichage
4. **Texte français** — vérifier que les labels sont en français (ex: "Volume total", "Durée moyenne")

### StatsScreen spécifiquement
C'est un écran de navigation avec des boutons vers les sous-écrans. Tester :
- Affiche les KPIs (séances totales, volume, etc.)
- Affiche les 7 boutons de navigation (Durée, Volume, Agenda, Muscles, Exercices, Mesures, Historique)
- Navigation.navigate est appelé au tap

### Mock des données
```ts
const mockHistory = {
  id: 'h1',
  date: new Date('2024-01-15').getTime(),
  deletedAt: null,
  durationMinutes: 45,
  programName: 'PPL',
  sessionName: 'Push',
}

const mockSet = {
  id: 's1',
  reps: 10,
  weight: 60,
  historyId: 'h1',
  exerciseId: 'e1',
}

const mockExercise = {
  id: 'e1',
  name: 'Développé couché',
  primaryMuscle: 'Pecs',
}
```

## Étapes
1. Lire chaque screen source pour identifier les exports et les props exactes
2. Si le composant Base n'est pas exporté, ajouter `export` devant la déclaration de fonction
3. Créer le fichier test avec les mocks standard
4. Écrire 3-5 tests par screen (rendu vide, rendu avec data, interaction, labels FR)
5. Lancer `cd mobile && npx jest --testPathPattern="screens/__tests__/Stats" --no-coverage` pour vérifier
6. Corriger les erreurs
7. Lancer `cd mobile && npx jest --coverage --no-cache` pour vérifier le gain de coverage

## Contraintes
- Ne pas casser les tests existants (847 tests passent actuellement)
- Utiliser `@testing-library/react-native` (pas enzyme)
- Pas de `any` dans les types
- Pas de `console.log` sans guard `__DEV__`
- Les messages/labels doivent être en français
- Utiliser `colors.*` du theme, pas de couleurs hardcodées
- Mock `react-native-chart-kit` car il n'a pas de rendu en test

## Critères de validation
- `npx tsc --noEmit` → zéro erreur
- `npm test` → zéro fail (tous les anciens + les nouveaux)
- Coverage lines ≥ 70% (gain d'au moins +5%)

## Dépendances
Aucune dépendance — ce groupe est autonome.

## Statut
✅ Résolu — 20260223-1530

## Résolution
Rapport do : docs/bmad/do/20260223-1530-test-stats-screens.md
