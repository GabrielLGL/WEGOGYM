<!-- v1.0 — 2026-02-26 -->
# Rapport — sets-range — Groupe A (Data layer) — 20260226-2200

## Objectif
Ajouter le support du champ `sets_target_max` dans la couche données pour permettre
une range de séries (ex: "3 à 5 séries") sur un `SessionExercise`.

## Fichiers concernés
- `mobile/src/model/schema.ts`
- `mobile/src/model/models/SessionExercise.ts`

## Contexte technique

### Schéma actuel (v23)
```typescript
tableSchema({
  name: 'session_exercises',
  columns: [
    { name: 'session_id', type: 'string', isIndexed: true },
    { name: 'exercise_id', type: 'string', isIndexed: true },
    { name: 'position', type: 'number' },
    { name: 'sets_target', type: 'number', isOptional: true },  // valeur actuelle (entier)
    { name: 'reps_target', type: 'string', isOptional: true },  // déjà string (ex: "8-12")
    { name: 'weight_target', type: 'number', isOptional: true },
    { name: 'created_at', type: 'number' },
    { name: 'updated_at', type: 'number' },
  ]
})
```

### Modèle actuel
```typescript
@field('sets_target') setsTarget?: number
@field('reps_target') repsTarget?: string
@field('weight_target') weightTarget?: number
```

### Règle critique WatermelonDB
- Pas de fichier migrations.ts dans ce projet → le schéma utilise une initialisation directe.
- Quand la version change, SQLite recrée la DB (acceptable en dev, sera géré en prod via migration).
- **Ajouter uniquement une colonne** `sets_target_max` (number, isOptional) — additive, non-breaking.

## Étapes

### 1. `mobile/src/model/schema.ts`
- Changer `version: 23` en `version: 24`
- Dans `session_exercises`, ajouter après `sets_target` :
  ```typescript
  { name: 'sets_target_max', type: 'number', isOptional: true },
  ```

### 2. `mobile/src/model/models/SessionExercise.ts`
- Ajouter le field après `setsTarget` :
  ```typescript
  @field('sets_target_max') setsTargetMax?: number
  ```
- Vérifier que l'import de `field` est déjà présent (il l'est).

## Contraintes
- Ne PAS changer le type de `sets_target` (reste `number`) — backward compatible.
- Ne PAS modifier d'autres tables dans schema.ts.
- Schema ↔ Model sync OBLIGATOIRE (pitfall CLAUDE.md 3.1) : toute colonne dans schema doit avoir un @field dans le modèle et vice-versa.
- `experimentalDecorators: true`, `useDefineForClassFields: false` (CLAUDE.md §3).

## Critères de validation
- `npx tsc --noEmit` → zéro erreur TypeScript
- `npm test` → zéro fail
- Le champ `setsTargetMax` est accessible sur `SessionExercise` instances.

## Dépendances
Aucune — groupe indépendant. Peut être lancé en parallèle avec Groupe B.

## Statut
✅ Résolu — 20260226-2200

## Résolution
Rapport do : docs/bmad/do/20260226-2200-feat-sets-range-A.md
