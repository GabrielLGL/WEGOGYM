<!-- v1.0 — 2026-02-21 -->
# Rapport — fix OpenAI provider — Groupe B — 20260221-1200

## Objectif
Améliorer les messages d'erreur dans SettingsScreen pour le provider OpenAI :
- Ajouter un hint explicatif pour l'erreur 429 OpenAI (billing non configuré)
- Ajouter un hint pour l'erreur 401 OpenAI (clé invalide)
- Sur le modèle exact de ce qui existe déjà pour Gemini (lignes 103-109)

## Fichiers concernés
1. `mobile/src/screens/SettingsScreen.tsx`

## Contexte technique
Le code actuel dans `handleTestConnection` (lignes 100-114) gère déjà des hints pour Gemini :
```typescript
const isGemini403 = aiProvider === 'gemini' && (errorMessage.includes('403') || ...)
const isGemini429 = aiProvider === 'gemini' && errorMessage.includes('429')
const hint = isGemini403 ? '...' : isGemini429 ? '...' : ''
```
Il faut ajouter le même pattern pour OpenAI.

**Causes connues OpenAI 429 (2026) :**
- Free tier OpenAI = seulement 3 req/min → inutilisable en pratique
- Compte sans billing → quota 0
- Solution : ajouter un crédit via platform.openai.com/settings/billing (minimum ~$5)

**Causes connues OpenAI 401 :**
- Clé API invalide ou révoquée
- Solution : générer une nouvelle clé sur platform.openai.com/api-keys

**Causes connues Claude 401 :**
- Clé `sk-ant-...` invalide
- Solution : console.anthropic.com

## Étapes

### Fichier : `mobile/src/screens/SettingsScreen.tsx`

Dans la fonction `handleTestConnection`, après les constantes `isGemini403` et `isGemini429`, ajouter :

```typescript
const isOpenAI429 = aiProvider === 'openai' && errorMessage.includes('429')
const isOpenAI401 = aiProvider === 'openai' && errorMessage.includes('401')
const isClaude401 = aiProvider === 'claude' && errorMessage.includes('401')
```

Puis étendre le ternaire `hint` pour couvrir ces cas (garder les cas Gemini existants, ajouter OpenAI/Claude) :
- `isOpenAI429` → `'\n\nQuota OpenAI insuffisant.\n\n• Ajoutez des crédits sur platform.openai.com/settings/billing (min. $5)\n• OU utilisez Claude ou Gemini'`
- `isOpenAI401` → `'\n\nClé API OpenAI invalide.\n\nGénérez une nouvelle clé sur platform.openai.com/api-keys'`
- `isClaude401` → `'\n\nClé API Claude invalide.\n\nGénérez une nouvelle clé sur console.anthropic.com'`

## Contraintes
- Ne pas modifier : les hints Gemini existants (403, 429) — ils fonctionnent bien
- Ne pas modifier : le reste du SettingsScreen (timer, restDuration, sauvegarde, etc.)
- Respecter : couleurs `colors.*` du theme — pas de couleurs hardcodées dans les messages (les Alert.alert sont du système natif, pas de styling custom)
- Respecter : langue française pour tous les messages utilisateur

## Critères de validation
- `npx tsc --noEmit` → zéro erreur
- `npm test` → zéro fail
- Avec un compte OpenAI sans billing → message d'erreur avec hint billing visible
- Avec une clé OpenAI invalide → message d'erreur avec hint api-keys visible
- Les hints Gemini existants restent inchangés

## Dépendances
Aucune dépendance — peut tourner en parallèle avec Groupe A.

## Statut
✅ Résolu — 20260221-1200

## Résolution
Rapport do : docs/bmad/do/20260221-1200-fix-settings.md
