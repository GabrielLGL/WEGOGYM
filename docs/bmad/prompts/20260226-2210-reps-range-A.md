<!-- v1.0 — 2026-02-26 -->
# Rapport — reps-range — Groupe A — 20260226-2210

## Objectif
Permettre à l'utilisateur de saisir une **fourchette de reps** dans l'input "Reps"
de `ExerciseTargetInputs`. Un seul champ accepte :
- `"8"` → nombre fixe (repMin = repMax = 8)
- `"6-8"` → range (repMin=6, repMax=8)

La valeur est stockée telle quelle dans `reps_target` (déjà `string` en DB — aucun
changement de schéma nécessaire).

## Fichiers concernés
1. `mobile/src/components/ExerciseTargetInputs.tsx`
2. `mobile/src/model/utils/validationHelpers.ts`

## Contexte technique

### État actuel de l'input Reps (`ExerciseTargetInputs.tsx`)
```typescript
const handleRepsChange = (value: string) => {
  if (value === '') { onRepsChange(value); return }
  const num = parseInt(value, 10)
  if (isNaN(num)) return          // ← bloque tout caractère non-numérique
  onRepsChange(String(Math.min(Math.max(num, 1), 99)))  // ← clamping entier
}
// ...
<TextInput
  keyboardType="numeric"    // ← ne permet pas le tiret "-"
  value={reps}
  onChangeText={handleRepsChange}
/>
```

### État actuel de la validation (`validateWorkoutInput`)
```typescript
// Reps validé comme entier pur :
if (!reps.trim() || reps === '0') {
  errors.push('...')
} else if (!isValidNumeric(reps, 0)) {   // ← isValidNumeric = parseFloat, ne supporte pas "6-8"
  errors.push('...')
}
```

### Schéma DB (`reps_target` dans `session_exercises`)
```typescript
{ name: 'reps_target', type: 'string', isOptional: true }
// Déjà string depuis toujours → aucun changement de schéma
```

### `ExerciseTargetInputs` — état actuel après sets-range (Group B déjà résolu)
Le composant a déjà de nouveaux props `setsMax` et `onSetsMaxChange`.
Ne PAS toucher ces props, uniquement modifier la partie Reps.

## Étapes

### 1. `mobile/src/components/ExerciseTargetInputs.tsx` — Input Reps

**a) Changer `keyboardType` de `"numeric"` à `"default"` pour l'input Reps uniquement.**

**b) Remplacer `handleRepsChange` :**
```typescript
const handleRepsChange = (value: string) => {
  if (value === '') { onRepsChange(value); return }
  // N'autoriser que les chiffres + un seul tiret (états intermédiaires "6-" acceptés)
  if (!/^\d{1,2}(-\d{0,2})?$/.test(value)) return
  onRepsChange(value)
}
```
- Permet `"8"`, `"12"`, `"6-"` (en cours de frappe), `"6-8"`, `"10-12"`
- Refuse les lettres, doubles tirets, etc.
- Plus de clamping sur l'input (la validation finale se fait à la soumission)

**c) Mettre à jour le JSDoc du composant :**
- Changer la description de `reps` : "Valeur du champ reps (entier OU range ex: '6-8')"
- Changer la description de `onRepsChange` : "Callback — la valeur peut être un entier ou une range"

### 2. `mobile/src/model/utils/validationHelpers.ts` — `validateWorkoutInput`

**Remplacer la section "Validation des répétitions" :**

```typescript
// Validation des répétitions (entier OU range "N-M")
if (!reps.trim() || reps === '0') {
  errors.push('Le nombre de répétitions est requis et doit être supérieur à 0')
} else {
  const repsParts = reps.split('-')
  if (repsParts.length === 1) {
    // Format entier simple
    const n = parseInt(repsParts[0], 10)
    if (isNaN(n) || n < 1 || n > 99) {
      errors.push('Le nombre de répétitions doit être un entier entre 1 et 99')
    }
  } else if (repsParts.length === 2) {
    // Format range "N-M"
    const rMin = parseInt(repsParts[0], 10)
    const rMax = parseInt(repsParts[1], 10)
    if (isNaN(rMin) || isNaN(rMax) || rMin < 1 || rMax < 1 || rMin > 99 || rMax > 99) {
      errors.push('La range de reps doit être entre 1 et 99')
    } else if (rMin > rMax) {
      errors.push('Le min de reps doit être ≤ au max')
    }
  } else {
    errors.push('Format de reps invalide — utiliser un entier ou une range (ex: 6-8)')
  }
}
```

## Contraintes
- Ne PAS modifier les props existants de `ExerciseTargetInputs` (seulement la logique interne reps).
- Ne PAS toucher les inputs Séries, SériesMax, Poids.
- Ne PAS changer la signature de `validateWorkoutInput` — les paramètres existants
  (`sets`, `reps`, `weight`, `setsMax`) restent identiques.
- `reps_target` est stocké tel quel (string) dans la DB — `useSessionManager.ts` fait
  déjà `se.repsTarget = reps` sans parsing — ne pas changer ça.
- Ne PAS ajouter `keyboardType="numbers-and-punctuation"` (iOS seulement) —
  utiliser `"default"` qui fonctionne Android + iOS.

## Critères de validation
- `npx tsc --noEmit` → zéro erreur
- `npm test` → zéro fail
- Comportement attendu dans l'input :
  - Tape `8` → value `"8"` ✅
  - Tape `6-8` → value `"6-8"` ✅
  - Tape `abc` → ignoré ✅
  - Tape `6-` → accepté temporairement (en cours de frappe) ✅
  - Tape `6-8-10` → ignoré (regex bloque) ✅
- Comportement validation :
  - `validateWorkoutInput("3", "8", "")` → valid ✅
  - `validateWorkoutInput("3", "6-8", "")` → valid ✅
  - `validateWorkoutInput("3", "8-6", "")` → errors (min > max) ✅
  - `validateWorkoutInput("3", "0", "")` → errors ✅
  - `validateWorkoutInput("3", "abc", "")` → errors ✅
- Les tests existants de `validateWorkoutInput` utilisant des entiers simples pour reps passent toujours ✅

## Dépendances
Aucune dépendance — groupe unique.

## Statut
⏳ En attente
