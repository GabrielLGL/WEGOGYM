# CHORE(ci) â€” Optimiser le workflow CI GitHub Actions
Date : 2026-02-19 13:35

## Instruction
Optimiser le workflow CI GitHub Actions pour rÃ©duire le temps d'exÃ©cution.
Fichier : .github/workflows/ci.yml

## Classification
Type : chore
Fichiers : `.github/workflows/ci.yml`

## Ce qui a Ã©tÃ© fait

### A) Cache node_modules (au lieu de cache npm)

**Avant :**
```yaml
- name: ðŸŸ¢ Setup Node.js
  uses: actions/setup-node@v4
  with:
    node-version: ${{ matrix.node-version }}
    cache: 'npm'
    cache-dependency-path: mobile/package-lock.json

- name: ðŸ“¦ Install dependencies
  working-directory: mobile
  run: npm ci --legacy-peer-deps
```

**AprÃ¨s :**
```yaml
- name: ðŸŸ¢ Setup Node.js
  uses: actions/setup-node@v4
  with:
    node-version: ${{ matrix.node-version }}

- name: ðŸ’¾ Cache node_modules
  uses: actions/cache@v4
  id: cache-node-modules
  with:
    path: mobile/node_modules
    key: ${{ runner.os }}-node-modules-${{ hashFiles('mobile/package-lock.json') }}
    restore-keys: |
      ${{ runner.os }}-node-modules-

- name: ðŸ“¦ Install dependencies
  if: steps.cache-node-modules.outputs.cache-hit != 'true'
  working-directory: mobile
  run: npm ci --legacy-peer-deps
```

**Gain estimÃ© :** Sur cache hit (2Ã¨me run+), `npm ci` est entiÃ¨rement skipÃ© â†’ **âˆ’3 Ã  4 min**

---

### B) Suppression de --coverage + ajout de --forceExit et --passWithNoTests

**Avant :**
```yaml
- name: ðŸ§ª Run tests
  working-directory: mobile
  run: npm test -- --coverage --watchAll=false
```

**AprÃ¨s :**
```yaml
- name: ðŸ§ª Run tests
  working-directory: mobile
  run: npm test -- --watchAll=false --passWithNoTests --forceExit
```

**Gain estimÃ© :** `--coverage` instrumentait tout le code (Istanbul), 2-4Ã— plus lent â†’ **âˆ’1 Ã  2 min**

---

### C) Suppression du step Codecov

`fail_ci_if_error: false` indiquait dÃ©jÃ  que Codecov Ã©tait purement optionnel et n'apportait pas de valeur critique.

**Gain estimÃ© :** **âˆ’30s**

---

### D) timeout-minutes: 10 ajoutÃ© au job

ProtÃ¨ge contre les runs bloquÃ©s indÃ©finiment.

---

## RÃ©sumÃ© des gains

| Optimisation | Gain (cache hit) | Gain (cache miss) |
|--------------|-----------------|-------------------|
| Cache node_modules | âˆ’3 Ã  4 min | 0 (npm ci quand mÃªme) |
| Supprimer --coverage | âˆ’1 Ã  2 min | âˆ’1 Ã  2 min |
| Supprimer Codecov | âˆ’30s | âˆ’30s |
| **Total estimÃ©** | **~6min â†’ <2min** | **~6min â†’ <3min** |

## VÃ©rification
- TypeScript : N/A (fichier YAML)
- Tests : N/A (pas de code source modifiÃ©)
- Nouveau test crÃ©Ã© : non

## Commit
3cb5404 chore(ci): optimize test workflow â€” cache node_modules + remove coverage
