# Rapport — statsHelpers tests + DRY refactoring stats — 2026-02-22

## Problème
Coverage de `statsHelpers.ts` à 0% (logique pure, 460 lignes, toutes les stats en dépendent).
11 warnings DRY/hardcoded non corrigés lors du verrif (chartConfig dupliqué, INTENSITY_COLORS hardcodées, labelToPeriod dupliqué, useWindowDimensions, fontSize:32).

## Fichiers concernés
- `mobile/src/model/utils/statsHelpers.ts` — tests à écrire
- `mobile/src/model/utils/__tests__/statsHelpers.test.ts` — à créer
- `mobile/src/theme/index.ts` — ajout tokens (INTENSITY_COLORS, fontSize hero)
- `mobile/src/theme/chartConfig.ts` — à créer (shared chart config)
- `mobile/src/screens/StatsDurationScreen.tsx` — remplacer chartConfig + useWindowDimensions
- `mobile/src/screens/StatsVolumeScreen.tsx` — remplacer chartConfig + labelToPeriod + useWindowDimensions + fontSize
- `mobile/src/screens/StatsRepartitionScreen.tsx` — remplacer labelToPeriod
- `mobile/src/screens/StatsCalendarScreen.tsx` — remplacer INTENSITY_COLORS + toDateKey
- `mobile/src/screens/StatsMeasurementsScreen.tsx` — remplacer chartConfig + useWindowDimensions

## Commande à lancer
/do docs/bmad/morning/20260222-1530-briefing.md

## Contexte
- `statsHelpers.ts` exporte 10 fonctions pures sans accès DB — idéal pour tests unitaires
- chartConfig est identique dans 4 fichiers (PRIMARY_RGB, TEXT_RGB, backgroundColor, etc.)
- `labelToPeriod` et `PERIOD_LABELS` sont identiques dans StatsVolumeScreen et StatsRepartitionScreen
- `INTENSITY_COLORS` dans StatsCalendarScreen utilise des hex hardcodés au lieu du thème
- `Dimensions.get('window').width` est capturé au module load et ne se met pas à jour à la rotation
- `toDateKey()` existe dans statsHelpers mais n'est pas exportée, dupliquée dans StatsCalendarScreen

## Critères de validation
- `npx tsc --noEmit` → 0 erreur
- `npm test` → 0 fail + coverage statsHelpers.ts > 80%
- Plus aucun chartConfig dupliqué dans les écrans stats
- Plus aucun PRIMARY_RGB/TEXT_RGB dans les écrans
- Plus aucune couleur hardcodée dans StatsCalendarScreen
- labelToPeriod et PERIOD_LABELS dans statsHelpers uniquement

## Statut
✅ Résolu — 20260222-1552

## Résolution
Rapport do : docs/bmad/do/20260222-1552-test-statsHelpers-DRY-refactor.md
